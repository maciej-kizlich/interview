<beans:beans xmlns="http://www.springframework.org/schema/security"
             xmlns:beans="http://www.springframework.org/schema/beans"
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
             xmlns:context="http://www.springframework.org/schema/context"
             xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans-3.0.xsd
			http://www.springframework.org/schema/security
			http://www.springframework.org/schema/security/spring-security-3.2.xsd 
			http://www.springframework.org/schema/context 
			http://www.springframework.org/schema/context/spring-context.xsd">

    <context:component-scan base-package="pl.maciejkizlich.interview.security"/>

    <authentication-manager>
        <authentication-provider user-service-ref="epamUserDetailsService" >
            <password-encoder hash="bcrypt"/>

        </authentication-provider>
    </authentication-manager>


    <beans:bean id="epamUserDetailsService"
                class="pl.maciejkizlich.interview.security.EpamUserDetailsService">
        <beans:property name="dataSource" ref="dataSource"/>
        <beans:property name="usersByUsernameQuery" value="select username, password, enabled, id from users where username=?" />
        <beans:property name="authoritiesByUsernameQuery" value="select u.username, a.authority from users u join user_authority ua on ua.user_id = u.id join authority a on a.id = ua.authority_id  where u.username = ?" />
    </beans:bean>

</beans:beans>